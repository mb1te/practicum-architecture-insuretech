## Анализ проблем и рисков текущей архитектуры InsureTech

Проблемы:
- Синхронный опрос внешних API. В одном запросе опрашиваются все страховые, при росте количества страховых возрастает риск таймаута
- Поллинг при обновлении локальных реплик в сервисах. Данные устаревают
- HTTP-взаимодействие. Падение сервиса вызывает проблемы в другом
- Нет гарантии доставки данных. Можно потерять обновление данных при ошибках в HTTP-запросах

Решение:
- Apache Kafka для асинхронного обмена между сервисами. Гарантия доставки at-least-once, возможность повторной обработки событий при сбоях
- Transactional Outbox в core-app (таблица outbox в core-db). При оформлении страховки: сохранение в БД + запись в outbox в одной транзакции. Debezium читает outbox и отправляет в Kafka
- Фоновая синхронизация в ins-product-aggregator. Периодический опрос СК в фоне, кэширование данных в Redis, публикация события в Kafka при изменении

Взаимодействие через Kafka:
- ins-product-aggregator публикует `ProductsUpdated`, core-app и ins-comp-settlement получают обновления продуктов/тарифов для локальных реплик
- core-app публикует `InsuranceIssued`, ins-comp-settlement получает данные об оформленных страховках для взаиморасчётов
